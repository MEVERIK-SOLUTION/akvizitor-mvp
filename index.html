<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>AKVIZITOR ‚Äì Ter√©nn√≠ a akviziƒçn√≠ manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <main class="app">
    <header class="topbar">
      <div class="brand">
        <div class="brand-mark">A</div>
        <div class="brand-text">
          <h1>AKVIZITOR</h1>
          <p class="subtitle">Ter√©nn√≠ a akviziƒçn√≠ manager pro realitn√≠ makl√©≈ôe</p>
        </div>
      </div>

      <div class="project-pill" id="currentProjectPill" hidden>
        <span class="dot"></span>
        <span class="pill-title" id="currentProjectTitle">Bez projektu</span>
        <button class="pill-btn" id="closeProjectBtn" type="button" title="Zav≈ô√≠t projekt">Zav≈ô√≠t</button>
      </div>
    </header>

    <nav class="tabs" aria-label="Navigace">
      <button class="tab is-active" data-view="project" type="button">Projekt</button>
      <button class="tab" data-view="collect" type="button">Sbƒõr</button>
      <button class="tab" data-view="plan2d" type="button">2D</button>
      <button class="tab" data-view="view3d" type="button">3D</button>
      <button class="tab" data-view="outputs" type="button">V√Ωstupy</button>
      <button class="tab" data-view="estimate" type="button">Odhad</button>
    </nav>

    <div class="layout">
      <aside class="sidebar card">
        <h2 class="h2">Checklist</h2>
        <ul class="checklist" id="checklist">
          <li><span class="chk" data-chk="project"></span> Zalo≈æen projekt</li>
          <li><span class="chk" data-chk="rooms"></span> P≈ôid√°ny m√≠stnosti</li>
          <li><span class="chk" data-chk="photos"></span> Fotky (voliteln√©)</li>
          <li><span class="chk" data-chk="plan2d"></span> 2D p≈Ødorys (dal≈°√≠ krok)</li>
          <li><span class="chk" data-chk="outputs"></span> Export v√Ωstup≈Ø</li>
        </ul>

        <div class="divider"></div>

        <h2 class="h2">Rychl√© akce</h2>
        <div class="stack">
          <button class="btn-secondary" id="quickExportProjectBtn" type="button">Export projektu (JSON)</button>
          <label class="btn-secondary filelike">
            Import projektu (JSON)
            <input id="quickImportInput" type="file" accept="application/json" hidden />
          </label>
        </div>

        <p class="hint">
          Tip: bez backendu ukl√°d√°me lok√°lnƒõ a pos√≠l√°me si projekty p≈ôes JSON. Pozdƒõji se to p≈ôepne na cloud.
        </p>
      </aside>

      <section class="main">

        <!-- VIEW: PROJEKT -->
        <section class="view card" id="view-project">
          <div class="view-header">
            <h2 class="h2">Projekt</h2>
            <p class="muted">Zalo≈æ, otev≈ôi a spravuj projekty. Tohle je ‚Äúdomov‚Äù cel√© akvizice.</p>
          </div>

          <div style="margin-top:12px">
            <button id="continueToCollect" class="btn-primary">Pokraƒçovat ‚Üí Sbƒõr</button>
          </div>

          <div class="grid2">
            <div>
              <h3 class="h3">Zalo≈æit nov√Ω projekt</h3>
              <form id="projectCreateForm" class="form">
                <div class="form-row">
                  <div class="form-group">
                    <label for="projName">N√°zev projektu</label>
                    <input id="projName" type="text" placeholder="nap≈ô. Byt ‚Äì Nov√°kovi" required />
                  </div>
                  <div class="form-group">
                    <label for="projType">Typ nemovitosti</label>
                    <select id="projType" required>
                      <option value="">‚Äî vyber ‚Äî</option>
                      <option value="byt">Byt</option>
                      <option value="dum">Rodinn√Ω d≈Øm</option>
                      <option value="pozemek">Pozemek</option>
                      <option value="komerce">Komerce</option>
                    </select>
                  </div>
                </div>

                <div class="form-group">
                  <label for="projAddress">Adresa (voliteln√©)</label>
                  <input id="projAddress" type="text" placeholder="Ulice, mƒõsto‚Ä¶" />
                </div>

                <button class="btn-primary" type="submit">Vytvo≈ôit projekt</button>
              </form>

              <div class="divider"></div>

              <h3 class="h3">Import projektu</h3>
              <p class="muted">Nahraj JSON projektu (nap≈ô. od juniora pro kontrolu seniora).</p>
              <label class="btn-secondary filelike">
                Vybrat JSON soubor
                <input id="importProjectInput" type="file" accept="application/json" hidden />
              </label>
              <p class="small muted" id="importStatus"></p>
            </div>

            <div>
              <h3 class="h3">Moje projekty</h3>
              <div id="projectsList" class="list"></div>
            </div>
          </div>
        </section>

        <!-- VIEW: SBƒöR -->
        <section class="view card" id="view-collect" hidden>
          <div class="view-header">
            <h2 class="h2">Sbƒõr dat</h2>
            <p class="muted">Formul√°≈ôe > kreslen√≠. Nejprve ƒç√≠sla, pak p≈Ødorys.</p>
          </div>

          <div class="notice" id="noProjectNotice" hidden>
            Nejd≈ô√≠v otev≈ôi nebo zalo≈æ projekt v z√°lo≈æce <b>Projekt</b>.
          </div>

          <div id="collectContent" hidden>
            <div class="grid2">
              <!-- FLOORS: v√Ωbƒõr patra + spr√°va -->
              <div class="card-inner" style="margin-top:0;">
                <form id="roomForm" class="form">
                  <div class="form-row">
                    <div class="form-group">
                      <label for="floorSelect">Patro</label>
                      <select id="floorSelect"></select>
                    </div>
                    <div class="form-group">
                      <label for="floorHeight">V√Ω≈°ka patra (m)</label>
                      <div style="display:flex; gap:10px; align-items:center;">
                        <input id="floorHeight" type="number" step="0.01" min="0" placeholder="nap≈ô. 2.60">
                        <button class="btn-mini" id="saveFloorHeightBtn" type="button">Ulo≈æit v√Ω≈°ku patra</button>
                      </div>
                      <div class="hint">V√Ωchoz√≠ v√Ω≈°ka pro v≈°echny m√≠stnosti na pat≈ôe. Pokud nen√≠ vyplnƒõn√°, 3D model se zat√≠m nevytvo≈ô√≠ (2D p≈Ødorys ano).</div>
                    </div>
                  </div>

                  <div class="form-row" style="margin-top:6px;">
                    <div class="form-group">
                      <label for="newFloorName">P≈ôidat patro</label>
                      <div style="display:flex; gap:10px;">
                        <input id="newFloorName" type="text" placeholder="nap≈ô. Suter√©n / Podkrov√≠ / 2. NP" />
                        <button id="addFloorBtn" class="btn-mini primary" type="button" style="width:auto; white-space:nowrap;">P≈ôidat</button>
                      </div>
                    </div>
                    <div class="item-actions" style="justify-content:flex-start; margin-top:20px;">
                      <button id="renameFloorBtn" class="btn-mini" type="button">P≈ôejmenovat patro</button>
                      <button id="deleteFloorBtn" class="btn-mini danger" type="button">Smazat patro</button>
                    </div>
                  </div>

                  <p class="small muted" id="floorHint" style="margin-top:8px;"></p>

                  <div class="divider"></div>

                  <h3 class="h3">P≈ôidat m√≠stnost</h3>
                  <div class="form-row">
                    <div class="form-group">
                      <label for="roomName">N√°zev m√≠stnosti</label>
                      <input id="roomName" type="text" placeholder="Ob√Ωvac√≠ pokoj" />
                    </div>
                    <div class="form-group">
                      <label for="roomLen">D√©lka (m)</label>
                      <input id="roomLen" type="number" min="0" step="0.01" placeholder="nap≈ô. 4.20" required />
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="roomWid">≈†√≠≈ôka (m)</label>
                      <input id="roomWid" type="number" min="0" step="0.01" placeholder="nap≈ô. 3.10" required />
                    </div>
                    <div class="form-group">
                      <label for="">V√Ω≈°ka m√≠stnosti</label>
                      <div style="display:flex; gap:10px; align-items:center;">
                        <input id="roomHeightOverrideToggle" type="checkbox" style="width:auto; height:auto;" />
                        <label for="roomHeightOverrideToggle" style="margin:0;">M√≠stnost m√° jinou v√Ω≈°ku ne≈æ patro</label>
                      </div>
                      <div style="margin-top:8px;">
                        <input id="roomHeight" type="number" step="0.01" min="0" placeholder="nap≈ô. 2.60" style="display:none; width: 100%;" />
                      </div>
                      <div class="hint">Pou≈æij jen pro atypick√© m√≠stnosti (nap≈ô. otev≈ôen√Ω strop, schodi≈°tƒõ).</div>
                    </div>
                  </div>

                  <button class="btn-primary" type="submit">P≈ôidat m√≠stnost</button>
                </form>
              </div>

              <div>
                <h3 class="h3">Seznam m√≠stnost√≠</h3>
                <div class="summary-row">
                  <div class="kpi">
                    <div class="kpi-label">M√≠stnost√≠</div>
                    <div class="kpi-value" id="kpiRooms">0</div>
                  </div>
                  <div class="kpi">
                    <div class="kpi-label">Celkem m¬≤</div>
                    <div class="kpi-value" id="kpiArea">0</div>
                  </div>
                </div>

                <div id="roomsList" class="list"></div>

                <div class="divider"></div>

                <h3 class="h3">Fotky (p≈ôi≈ôazen√≠ k m√≠stnosti)</h3>
                <p class="muted small">
  Vyber m√≠stnost a nahraj fotky. V exportu se ulo≈æ√≠ s <b>roomId</b> (p√°rov√°n√≠ do DB).
              </p>
          
            <div class="form-row">
             <div class="form-group">
              <label for="photoRoomSelect">P≈ôi≈ôadit k m√≠stnosti</label>
              <select id="photoRoomSelect"></select>
           </div>
           <div class="form-group">
            <label>&nbsp;</label>
            <label class="btn-secondary filelike" style="margin-top:0;">
             P≈ôidat fotky
            <input id="photosInput" type="file" accept="image/*" multiple hidden />
         </label>
      </div>
   </div>

<div id="photosList" class="chips"></div>

              </div>
            </div>
          </div>
        </section>

        <div style="margin-top:12px;">
          <button id="continueTo2D" class="btn-primary">Pokraƒçovat ‚Üí 2D</button>
        </div>

        <!-- VIEW: 2D -->
        <section class="view card" id="view-plan2d" hidden>
          <div class="view-header">
            <h2 class="h2">2D p≈Ødorys ‚Äì Editor</h2>
            <p class="muted">Interaktivn√≠ editor ‚Äì t√°hnƒõte m√≠stnosti, p≈ôipojujte dve≈ôe, upravujte layout.</p>
          </div>

          <div id="noRoomsNotice2D" class="notice" hidden>
            Na tomto pat≈ôe nejsou ≈æ√°dn√© m√≠stnosti. P≈ôidej je v z√°lo≈æce <b>Sbƒõr</b>.
          </div>

          <div id="plan2dContent" hidden>
            <!-- TOOLBAR -->
            <div class="plan2d-toolbar">
              <div class="toolbar-group">
                <label>Zoom</label>
                <input id="plan2dZoomSlider" type="range" min="0.25" max="3" step="0.25" value="1" style="width:120px;">
                <span id="plan2dZoomLabel">100%</span>
                <button id="plan2dZoomReset" class="btn-mini" type="button">Reset</button>
              </div>
              <div class="toolbar-group">
                <label>
                  <input id="plan2dSnapToggle" type="checkbox" checked style="width:auto; height:auto;">
                  Snap (0.15m)
                </label>
              </div>
              <div class="toolbar-group">
                <button id="plan2dExportPng" class="btn-mini secondary" type="button">Export PNG</button>
              </div>
            </div>

            <!-- CANVAS & SIDEBAR (responsive) -->
            <div class="plan2d-container">
              <!-- CANVAS -->
              <div class="plan2d-main">
                <div class="plan2d-canvas-frame">
                  <svg id="plan2dSvg" style="background:#fafafa; border:1px solid var(--stroke); cursor:move; touch-action:none;"></svg>
                </div>

                <!-- DETAIL PANEL -->
                <div id="plan2dPanel" class="plan2d-detail-panel card-inner">
                  <div id="plan2dPanelContent">
                    <p class="muted small">Klikni na m√≠stnost pro editaci.</p>
                  </div>
                </div>
              </div>

              <!-- ROOM REGISTRY (mobile sidebar) -->
              <div class="plan2d-registry">
                <div class="plan2d-registry-header">
                  <h3 class="h3">M√≠stnosti</h3>
                  <button id="plan2dRegistryClose" class="btn-mini" type="button" title="Zav≈ô√≠t seznam">‚úï</button>
                </div>
                <div id="plan2dRoomsList" class="plan2d-rooms-list">
                  <!-- dynamically rendered -->
                </div>
              </div>
            </div>

            <!-- MOBILE: toggle registry button -->
            <button id="plan2dShowRegistry" class="plan2d-show-registry" type="button" hidden>
              <span>üìã</span> M√≠stnosti
            </button>

            <p class="hint" style="margin-top:12px; font-size:0.85rem;">
              <b>Ovl√°d√°n√≠ (desktop):</b> Klik = vybrat pokoji ¬∑ Poklikat &amp; t√°hnout = posunout ¬∑ <b>Ctrl + Scroll</b> = zoom ¬∑ <b>Space + t√°h.</b> = pan ¬∑
              
              <b style="display:block; margin-top:6px;">Ovl√°d√°n√≠ (mobil):</b> Tap = vybrat pokoji ¬∑ Long-press &amp; t√°h = posunout ¬∑ Pinch = zoom ¬∑ 2-finger = pan ¬∑
              
              <b style="display:block; margin-top:6px;">Dve≈ôe:</b> Kliknout na marker = vytvo≈ôit odkaz
            </p>
          </div>
        </section>

        <!-- OPENINGS / ROOM DETAILS MODAL -->
        <div id="openingsModal" class="modal" hidden>
          <div class="modal-backdrop"></div>
          <div class="modal-content card">
            <div class="modal-header">
              <h3 id="openingsModalTitle">Detaily m√≠stnosti</h3>
              <button id="openingsModalClose" class="btn-mini" type="button">‚úï</button>
            </div>
            <div id="openingsModalBody" class="modal-body">
              <!-- dynamic content: openings + height override -->
            </div>
          </div>
        </div>

        <!-- VIEW: 3D -->
        <section class="view card" id="view-view3d" hidden>
          <div class="view-header">
            <h2 class="h2">3D kontrola</h2>
            <p class="muted">3D nen√≠ CAD ‚Äì je to rychl√° validace proporc√≠. P≈ôijde po 2D.</p>
          </div>
          <div class="placeholder">
            <p><b>Stav:</b> p≈ôipraveno. Po 2D p≈Ødorysu udƒõl√°me extruzi do jednoduch√©ho 3D.</p>
          </div>
        </section>

        <!-- VIEW: V√ùSTUPY -->
        <section class="view card" id="view-outputs" hidden>
          <div class="view-header">
            <h2 class="h2">V√Ωstupy</h2>
            <p class="muted">Export projektu, souhrny, pozdƒõji PDF a PNG.</p>
          </div>

          <div class="notice" id="noProjectNoticeOutputs" hidden>
            Nejd≈ô√≠v otev≈ôi nebo zalo≈æ projekt v z√°lo≈æce <b>Projekt</b>.
          </div>

          <div id="outputsContent" hidden>
            <div class="stack">
              <button class="btn-primary" id="exportProjectBtn" type="button">Export projektu (JSON)</button>
              <button class="btn-secondary" id="exportRoomsCsvBtn" type="button">Export m√≠stnost√≠ (CSV)</button>
            </div>

            <div class="divider"></div>

            <h3 class="h3">Souhrn projektu</h3>
            <div id="outputsSummary" class="placeholder"></div>
          </div>
        </section>

        <!-- VIEW: ODHAD (tv≈Øj p≈Øvodn√≠ modul) -->
        <section class="view card" id="view-estimate" hidden>
          <div class="view-header">
            <h2 class="h2">Odhad ceny</h2>
            <p class="muted">Zjednodu≈°en√Ω model (prozat√≠m). Ulo≈æ√≠ se do projektu jako ‚Äúcalc‚Äù.</p>
          </div>

          <section class="card-inner">
            <form id="calculator-form">

              <div class="form-group">
                <label for="propertyType">Typ nemovitosti</label>
                <select id="propertyType" required>
                  <option value="">‚Äî vyber ‚Äî</option>
                  <option value="byt">Byt</option>
                  <option value="dum">Rodinn√Ω d≈Øm</option>
                  <option value="pozemek">Pozemek</option>
                </select>
              </div>

              <div class="form-group">
                <label for="area">Plocha (m¬≤)</label>
                <input type="number" id="area" min="1" placeholder="nap≈ô. 120" required />
              </div>

              <div class="form-group">
                <label for="locality">Lokalita</label>
                <select id="locality" required>
                  <option value="">‚Äî vyber ‚Äî</option>
                  <option value="praha">Praha</option>
                  <option value="kraj">Krajsk√© mƒõsto</option>
                  <option value="okres">Okresn√≠ mƒõsto</option>
                  <option value="venkov">Venkov</option>
                </select>
              </div>

              <div class="form-group">
                <label for="condition">Stav nemovitosti</label>
                <select id="condition" required>
                  <option value="">‚Äî vyber ‚Äî</option>
                  <option value="novostavba">Novostavba</option>
                  <option value="dobry">Dobr√Ω stav</option>
                  <option value="pred_rekonstrukci">P≈ôed rekonstrukc√≠</option>
                </select>
              </div>

              <button type="submit" class="btn-primary">Spoƒç√≠tat orientaƒçn√≠ cenu</button>
              <button type="button" id="resetBtn" class="btn-secondary">Resetovat</button>

            </form>
          </section>

          <section class="card-inner result" id="result" hidden>
            <h3 class="h3">V√Ωsledek kalkulace</h3>
            <p id="priceOutput"></p>
            <p id="summaryOutput" class="summary"></p>

            <div class="stack">
              <button id="exportJsonBtn" class="btn-secondary" type="button">Exportovat v√Ωsledek (JSON)</button>
              <button id="saveCalcToProjectBtn" class="btn-primary" type="button">Ulo≈æit do projektu</button>
            </div>
            <p class="small muted" id="saveCalcStatus"></p>
          </section>

        </section>

        <footer class="app-footer">
          <small>MEVERIK ¬∑ AKVIZITOR MVP</small>
        </footer>
      </section>
    </div>
  </main>

  <script src="plan2d.js"></script>
  <script src="app.js"></script>
</body>
</html>